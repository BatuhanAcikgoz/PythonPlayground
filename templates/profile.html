<!DOCTYPE html>
<html>
<head>
    <title>{{ user.username }} - {{ _('app_name') }}</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- TailwindCSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        html, body, #root {
            height: 100%;
        }
        #root {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        .badge {
            transition: transform 0.3s ease;
        }
        .badge:hover {
            transform: scale(1.1);
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script>
        window.APP_DATA = {
            isLoggedIn: {{ current_user.is_authenticated|tojson }},
            userData: {
                username: {{ current_user.username|tojson if current_user.is_authenticated else 'null'|safe }},
                email: {{ current_user.email|tojson if current_user.is_authenticated else 'null'|safe }}
            },
            profileData: {
                username: {{ user.username|tojson }},
                email: {{ user.email|tojson }},
                joinDate: {{ user.created_at|string|tojson if user.created_at else '""'|safe }},
                isCurrentUser: {{ (current_user.id == user.id)|tojson }},
                badges: [
                    { id: 1, name: "Python Master", icon: "üêç", description: "Tamamlanan 10 Python kursu" },
                    { id: 2, name: "√á√∂z√ºm Ustasƒ±", icon: "üí°", description: "100 problemi √ß√∂zd√º" },
                    { id: 3, name: "Aktif √ñƒürenci", icon: "üî•", description: "30 g√ºn √ºst √ºste platform kullanƒ±mƒ±" }
                ],
                stats: {
                    completedCourses: 7,
                    solvedProblems: 124,
                    codingDays: 42,
                    activeDaysStreak: 12
                },
                activities: [
                    { id: 1, type: "course_completion", course: "Python Temelleri", date: "2023-11-15" },
                    { id: 2, type: "problem_solved", problem: "Fibonacci Dizisi", date: "2023-11-14" },
                    { id: 3, type: "notebook_shared", notebook: "Veri Analizi √ñrneƒüi", date: "2023-11-10" }
                ],
                friends: [
                    { id: 1, username: "ahmet", avatar: "https://i.pravatar.cc/150?img=1" },
                    { id: 2, username: "ayse", avatar: "https://i.pravatar.cc/150?img=2" },
                    { id: 3, username: "mehmet", avatar: "https://i.pravatar.cc/150?img=3" }
                ],
                notebooks: [
                    { id: 1, title: "Veri G√∂rselle≈ütirme", date: "2023-11-08", likes: 24 },
                    { id: 2, title: "ML Model Eƒüitimi", date: "2023-10-25", likes: 18 },
                    { id: 3, title: "Web Scraping √ñrnekleri", date: "2023-10-15", likes: 32 }
                ]
            },
            // Header translations
            headerTrans: {
                appName: {{ _('app_name')|tojson|safe }},
                tagline: {{ _('app_tagline')|tojson|safe }},
                home: {{ _('home')|tojson|safe }},
                courses: {{ _('courses')|tojson|safe }},
                leaderboard: {{ _('leaderboard')|tojson|safe }},
                about: {{ _('about')|tojson|safe }},
                logout: {{ _('logout')|tojson|safe }},
                login: {{ _('login')|tojson|safe }},
                register: {{ _('register')|tojson|safe }},
                profile: "Profile",
                settings: "Settings"
            },
            // Footer translations
            footerTrans: {
                allRights: {{ _('all_rights')|tojson|safe }},
                platformDesc: {{ _('platform_desc')|tojson|safe }}
            },
            // Current language
            currentLang: {{ session.get('language', 'tr')|tojson }},
            translations: {
                profile: {{ _('profile')|tojson|safe }} || "Profil",
                edit_profile: {{ _('edit_profile')|tojson|safe }} || "Profili D√ºzenle",
                badges: {{ _('badges')|tojson|safe }} || "Rozetler",
                statistics: {{ _('statistics')|tojson|safe }} || "ƒ∞statistikler",
                completed_courses: {{ _('completed_courses')|tojson|safe }} || "Tamamlanan Kurslar",
                solved_problems: {{ _('solved_problems')|tojson|safe }} || "√á√∂z√ºlen Problemler",
                coding_days: {{ _('coding_days')|tojson|safe }} || "Kodlama G√ºnleri",
                active_streak: {{ _('active_streak')|tojson|safe }} || "Aktif G√ºn Serisi",
                recent_activities: {{ _('recent_activities')|tojson|safe }} || "Son Aktiviteler",
                friends: {{ _('friends')|tojson|safe }} || "Arkada≈ülar",
                notebooks: {{ _('notebooks')|tojson|safe }} || "Defterler",
                view: {{ _('view')|tojson|safe }} || "G√∂r√ºnt√ºle",
                see_all: {{ _('see_all')|tojson|safe }} || "T√ºm√ºn√º G√∂r",
                member_since: {{ _('member_since')|tojson|safe }} || "√úyelik Tarihi",
                send_message: {{ _('send_message')|tojson|safe }} || "Mesaj G√∂nder"
            }
        };
    </script>

    <!-- Komponent scriptlerini y√ºkle -->
    <script type="text/babel" src="{{ url_for('main.serve_component', filename='Header.jsx') }}"></script>
    <script type="text/babel" src="{{ url_for('main.serve_component', filename='Footer.jsx') }}"></script>

    <script type="text/babel">
        const ProfilePage = () => {
            const { profileData, translations } = window.APP_DATA;
            const [activeTab, setActiveTab] = React.useState('activities');
            const chartRef = React.useRef(null);

            React.useEffect(() => {
                if (!chartRef.current) return;

                const ctx = chartRef.current.getContext('2d');
                const chart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: ['6 g√ºn √∂nce', '5 g√ºn √∂nce', '4 g√ºn √∂nce', '3 g√ºn √∂nce', '2 g√ºn √∂nce', 'D√ºn', 'Bug√ºn'],
                        datasets: [{
                            label: 'G√ºnl√ºk Aktivite',
                            data: [2, 4, 3, 5, 7, 4, 6],
                            fill: true,
                            backgroundColor: 'rgba(59, 130, 246, 0.2)',
                            borderColor: 'rgba(59, 130, 246, 1)',
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    precision: 0
                                }
                            }
                        }
                    }
                });

                return () => chart.destroy();
            }, []);

            const formatDate = (dateString) => {
                const date = new Date(dateString);
                return new Intl.DateTimeFormat('tr-TR').format(date);
            };

            const renderActivityIcon = (type) => {
                switch(type) {
                    case 'course_completion': return 'üéì';
                    case 'problem_solved': return '‚úÖ';
                    case 'notebook_shared': return 'üìù';
                    default: return 'üîî';
                }
            };

            const renderActivityText = (activity) => {
                switch(activity.type) {
                    case 'course_completion':
                        return `"${activity.course}" kursunu tamamladƒ±`;
                    case 'problem_solved':
                        return `"${activity.problem}" problemini √ß√∂zd√º`;
                    case 'notebook_shared':
                        return `"${activity.notebook}" defterini payla≈ütƒ±`;
                    default:
                        return 'Bir etkinlik ger√ßekle≈ütirdi';
                }
            };

            return (
                <div className="flex flex-col flex-grow">
                    <Header />

                    <main className="flex-grow bg-gray-50">
                        <div className="container mx-auto py-6 px-4">
                            {/* Profil √úst Kƒ±smƒ± */}
                            <div className="bg-white shadow-md rounded-lg overflow-hidden mb-6">
                                <div className="bg-gradient-to-r from-blue-500 to-indigo-600 h-32 md:h-48"></div>
                                <div className="px-6 py-4 md:flex md:items-center md:justify-between">
                                    <div className="flex items-center">
                                        <div className="bg-white p-1 rounded-full shadow-lg -mt-16 md:-mt-24">
                                            <img
                                                src={`https://ui-avatars.com/api/?name=${profileData.username}&size=128&background=random`}
                                                alt={profileData.username}
                                                className="rounded-full w-24 h-24 md:w-32 md:h-32"
                                            />
                                        </div>
                                        <div className="ml-4 md:ml-6">
                                            <h1 className="text-2xl md:text-3xl font-bold">{profileData.username}</h1>
                                            <p className="text-gray-600">{profileData.email}</p>
                                            <p className="text-gray-500 text-sm">
                                                {translations.member_since}: {formatDate(profileData.joinDate)}
                                            </p>
                                        </div>
                                    </div>
                                    <div className="mt-4 md:mt-0 flex">
                                        {profileData.isCurrentUser ? (
                                            <a
                                                href="/settings"
                                                className="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition"
                                            >
                                                {translations.edit_profile}
                                            </a>
                                        ) : (
                                            <button
                                                className="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition"
                                            >
                                                {translations.send_message}
                                            </button>
                                        )}
                                    </div>
                                </div>
                            </div>

                            {/* ƒ∞statistikler */}
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                                {/* ƒ∞statistik Kartlarƒ± */}
                                <div className="bg-white shadow-md rounded-lg overflow-hidden">
                                    <div className="p-6">
                                        <h2 className="text-lg font-semibold mb-4">{translations.statistics}</h2>
                                        <div className="grid grid-cols-2 gap-4">
                                            <div className="bg-blue-50 p-4 rounded-lg text-center">
                                                <div className="text-2xl font-bold text-blue-600">
                                                    {profileData.stats.completedCourses}
                                                </div>
                                                <div className="text-sm text-gray-600">{translations.completed_courses}</div>
                                            </div>
                                            <div className="bg-green-50 p-4 rounded-lg text-center">
                                                <div className="text-2xl font-bold text-green-600">
                                                    {profileData.stats.solvedProblems}
                                                </div>
                                                <div className="text-sm text-gray-600">{translations.solved_problems}</div>
                                            </div>
                                            <div className="bg-purple-50 p-4 rounded-lg text-center">
                                                <div className="text-2xl font-bold text-purple-600">
                                                    {profileData.stats.codingDays}
                                                </div>
                                                <div className="text-sm text-gray-600">{translations.coding_days}</div>
                                            </div>
                                            <div className="bg-orange-50 p-4 rounded-lg text-center">
                                                <div className="text-2xl font-bold text-orange-600">
                                                    {profileData.stats.activeDaysStreak}
                                                </div>
                                                <div className="text-sm text-gray-600">{translations.active_streak}</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                {/* Aktivite Grafiƒüi */}
                                <div className="bg-white shadow-md rounded-lg overflow-hidden">
                                    <div className="p-6">
                                        <h2 className="text-lg font-semibold mb-4">Aktivite Grafiƒüi</h2>
                                        <canvas ref={chartRef}></canvas>
                                    </div>
                                </div>

                                {/* Rozetler */}
                                <div className="bg-white shadow-md rounded-lg overflow-hidden">
                                    <div className="p-6">
                                        <h2 className="text-lg font-semibold mb-4">{translations.badges}</h2>
                                        <div className="flex flex-wrap gap-4">
                                            {profileData.badges.map(badge => (
                                                <div
                                                    key={badge.id}
                                                    className="badge flex flex-col items-center tooltip"
                                                    title={badge.description}
                                                >
                                                    <div className="text-4xl mb-2">{badge.icon}</div>
                                                    <div className="text-sm font-medium text-center">{badge.name}</div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                            </div>

                            {/* Sekmeli B√∂l√ºmler */}
                            <div className="bg-white shadow-md rounded-lg overflow-hidden">
                                <div className="border-b">
                                    <div className="flex">
                                        <button
                                            className={`px-4 py-3 font-medium ${activeTab === 'activities' ?
                                                'text-blue-600 border-b-2 border-blue-600' : 'text-gray-600 hover:text-gray-800'}`}
                                            onClick={() => setActiveTab('activities')}
                                        >
                                            {translations.recent_activities}
                                        </button>
                                        <button
                                            className={`px-4 py-3 font-medium ${activeTab === 'notebooks' ?
                                                'text-blue-600 border-b-2 border-blue-600' : 'text-gray-600 hover:text-gray-800'}`}
                                            onClick={() => setActiveTab('notebooks')}
                                        >
                                            {translations.notebooks}
                                        </button>
                                        <button
                                            className={`px-4 py-3 font-medium ${activeTab === 'friends' ?
                                                'text-blue-600 border-b-2 border-blue-600' : 'text-gray-600 hover:text-gray-800'}`}
                                            onClick={() => setActiveTab('friends')}
                                        >
                                            {translations.friends}
                                        </button>
                                    </div>
                                </div>

                                {/* Sekme ƒ∞√ßerikleri */}
                                <div className="p-6">
                                    {activeTab === 'activities' && (
                                        <div>
                                            <div className="space-y-4">
                                                {profileData.activities.map(activity => (
                                                    <div key={activity.id} className="flex p-3 border rounded-lg hover:bg-gray-50">
                                                        <div className="text-2xl mr-4">
                                                            {renderActivityIcon(activity.type)}
                                                        </div>
                                                        <div className="flex-grow">
                                                            <p>{renderActivityText(activity)}</p>
                                                            <p className="text-sm text-gray-500">{formatDate(activity.date)}</p>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                            <div className="mt-4 text-center">
                                                <button className="text-blue-600 hover:underline">
                                                    {translations.see_all}
                                                </button>
                                            </div>
                                        </div>
                                    )}

                                    {activeTab === 'notebooks' && (
                                        <div>
                                            <div className="overflow-x-auto">
                                                <table className="w-full text-left">
                                                    <thead>
                                                        <tr className="border-b">
                                                            <th className="pb-3 font-medium">Ba≈ülƒ±k</th>
                                                            <th className="pb-3 font-medium">Tarih</th>
                                                            <th className="pb-3 font-medium">Beƒüeniler</th>
                                                            <th className="pb-3 font-medium"></th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        {profileData.notebooks.map(notebook => (
                                                            <tr key={notebook.id} className="border-b hover:bg-gray-50">
                                                                <td className="py-3">{notebook.title}</td>
                                                                <td className="py-3">{formatDate(notebook.date)}</td>
                                                                <td className="py-3">‚ù§Ô∏è {notebook.likes}</td>
                                                                <td className="py-3">
                                                                    <button className="text-blue-600 hover:underline">
                                                                        {translations.view}
                                                                    </button>
                                                                </td>
                                                            </tr>
                                                        ))}
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    )}

                                    {activeTab === 'friends' && (
                                        <div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4">
                                            {profileData.friends.map(friend => (
                                                <a
                                                    key={friend.id}
                                                    href={`/profil/${friend.username}`}
                                                    className="flex flex-col items-center p-4 border rounded-lg hover:bg-gray-50"
                                                >
                                                    <img
                                                        src={friend.avatar}
                                                        alt={friend.username}
                                                        className="w-16 h-16 rounded-full mb-2"
                                                    />
                                                    <span className="font-medium">{friend.username}</span>
                                                </a>
                                            ))}
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>
                    </main>

                    <Footer />
                </div>
            );
        };

        ReactDOM.render(<ProfilePage />, document.getElementById('root'));
    </script>
</body>
</html>