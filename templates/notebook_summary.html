<!DOCTYPE html>
<html>
<head>
    <title>{{ notebook_path }} - AI Özeti</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- TailwindCSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <!-- Markdown işleme için marked kütüphanesi -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- Highlight.js for code syntax -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
<style>
    /* Temel prose stilleri korunuyor */
    .prose {
        max-width: 65ch;
        font-size: 1.05rem;
        line-height: 1.7;
        color: rgba(55, 65, 81, 1);
    }

    /* Daha süslü başlık stilleri */
    .prose h1, .prose h2, .prose h3, .prose h4 {
        margin-top: 2em;
        margin-bottom: 1em;
        font-weight: 700;
        line-height: 1.3;
        color: rgba(31, 41, 55, 1);
        letter-spacing: -0.025em;
    }

    .prose h1 {
        font-size: 2.25em;
        border-bottom: 2px solid rgba(219, 234, 254, 1);
        padding-bottom: 0.3em;
    }

    .prose h2 {
        font-size: 1.7em;
        border-bottom: 1px solid rgba(219, 234, 254, 1);
        padding-bottom: 0.3em;
    }

    .prose h3 { font-size: 1.4em; color: rgba(59, 130, 246, 0.9); }
    .prose h4 { font-size: 1.2em; font-style: italic; }

    /* Süslü listeler */
    .prose ul, .prose ol {
        margin-top: 1em;
        margin-bottom: 1.5em;
        padding-left: 1.5em;
    }

    .prose ul {
        list-style-type: none;
    }

    .prose ul li {
        position: relative;
        margin-top: 0.7em;
        margin-bottom: 0.7em;
        padding-left: 0.5em;
    }

    .prose ul li::before {
        content: "•";
        position: absolute;
        left: -1em;
        color: rgba(37, 99, 235, 0.8);
        font-weight: bold;
        font-size: 1.2em;
    }

    .prose ol {
        list-style-type: decimal;
        counter-reset: list-counter;
    }

    .prose ol li {
        position: relative;
        margin-top: 0.7em;
        margin-bottom: 0.7em;
    }

    /* İç içe listelerde stillemeler */
    .prose ul ul, .prose ol ol,
    .prose ul ol, .prose ol ul {
        margin-top: 0.5em;
        margin-bottom: 0.5em;
    }

    /* Kod blokları için süslü stillemeler */
    .prose code {
        color: rgba(185, 28, 28, 1);
        background-color: rgba(249, 250, 251, 1);
        padding: 0.2em 0.4em;
        border-radius: 0.25em;
        font-family: ui-monospace, monospace;
        font-size: 0.9em;
    }

    .prose pre {
        background-color: rgba(243, 244, 246, 1);
        border-radius: 0.5em;
        padding: 1em 1.2em;
        margin: 1.5em 0;
        overflow-x: auto;
        border-left: 4px solid rgba(59, 130, 246, 0.7);
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .prose pre code {
        background-color: transparent;
        color: rgba(31, 41, 55, 0.9);
        padding: 0;
        font-size: 0.9em;
    }

    /* Paragraflar ve alıntılar */
    .prose p {
        margin-bottom: 1.5em;
        text-align: justify;
    }

    .prose blockquote {
        border-left: 4px solid rgba(37, 99, 235, 0.5);
        padding-left: 1.2em;
        margin-left: 0;
        margin-right: 0;
        font-style: italic;
        color: rgba(75, 85, 99, 1);
        background-color: rgba(243, 244, 246, 0.8);
        padding: 1em 1.2em;
        border-radius: 0.5em;
    }

    /* Tablolar için süslü görünüm */
    .prose table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
        margin: 2em 0;
        font-size: 0.9em;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        border-radius: 0.5em;
        overflow: hidden;
    }

    .prose th {
        background-color: rgba(59, 130, 246, 0.1);
        color: rgba(31, 41, 55, 1);
        font-weight: 600;
        padding: 0.75em 1em;
        text-align: left;
        border-bottom: 2px solid rgba(59, 130, 246, 0.2);
    }

    .prose td {
        padding: 0.75em 1em;
        border-bottom: 1px solid rgba(229, 231, 235, 1);
    }

    .prose tr:last-child td {
        border-bottom: none;
    }

    .prose tr:nth-child(even) {
        background-color: rgba(249, 250, 251, 1);
    }

    /* Bağlantılar */
    .prose a {
        color: rgba(37, 99, 235, 1);
        text-decoration: none;
        border-bottom: 1px dotted rgba(37, 99, 235, 0.4);
        transition: border-bottom 0.2s, color 0.2s;
    }

    .prose a:hover {
        border-bottom: 1px solid rgba(37, 99, 235, 0.8);
        color: rgba(30, 64, 175, 1);
    }

    /* Özel vurgulamalar */
    .prose strong {
        font-weight: 600;
        color: rgba(31, 41, 55, 1);
    }

    .prose em {
        font-style: italic;
        color: rgba(55, 65, 81, 0.9);
    }

    /* Yatay çizgiler */
    .prose hr {
        border: 0;
        height: 1px;
        background-image: linear-gradient(to right, rgba(209, 213, 219, 0), rgba(107, 114, 128, 0.5), rgba(209, 213, 219, 0));
        margin: 2.5em 0;
    }
</style>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script>
        window.APP_DATA = {
            isLoggedIn: {{ current_user.is_authenticated|tojson }},
            userData: {
                username: {{ current_user.username|tojson if current_user.is_authenticated else 'null'|safe }},
                email: {{ current_user.email|tojson if current_user.is_authenticated else 'null'|safe }}
            },
            headerTrans: {
                appName: {{ _('app_name')|tojson|safe }},
                tagline: {{ _('app_tagline')|tojson|safe }},
                home: {{ _('home')|tojson|safe }},
                courses: {{ _('courses')|tojson|safe }},
                leaderboard: {{ _('leaderboard')|tojson|safe }},
                about: {{ _('about')|tojson|safe }},
                logout: {{ _('logout')|tojson|safe }},
                login: {{ _('login')|tojson|safe }},
                register: {{ _('register')|tojson|safe }},
                profile: "Profile",
                settings: "Settings"
            },
            footerTrans: {
                allRights: {{ _('all_rights')|tojson|safe }},
                platformDesc: {{ _('platform_desc')|tojson|safe }}
            },
            currentLang: {{ session.get('language', 'tr')|tojson }},
            notebookPath: {{ notebook_path|tojson|safe }},
            summaryData: {{ summary_data|tojson|safe }},
        };
    </script>

    <!-- Load component scripts -->
    <script type="text/babel" src="{{ url_for('main.serve_component', filename='Header.jsx') }}"></script>
    <script type="text/babel" src="{{ url_for('main.serve_component', filename='Footer.jsx') }}"></script>

    <script type="text/babel">
        const App = () => {
            const notebookPath = window.APP_DATA.notebookPath;
            const summaryData = window.APP_DATA.summaryData;

            // Markdown'ı HTML'e dönüştürmek için
            const renderMarkdown = (markdown) => {
                if (!markdown) return "";
                return { __html: marked.parse(markdown) };
            };

            React.useEffect(() => {
                // Kod bloklarına sözdizimi vurgulaması
                setTimeout(() => {
                    document.querySelectorAll('pre code').forEach((block) => {
                        hljs.highlightElement(block);
                    });
                }, 100);
            }, []);

            const formatDate = (dateString) => {
                if (!dateString) return '';
                const date = new Date(dateString);
                return new Intl.DateTimeFormat('tr-TR', {
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                }).format(date);
            };

            return (
                <React.Fragment>
                    <Header />
                    <main className="flex-grow container mx-auto px-4 py-8">
                        <div className="max-w-4xl mx-auto">
                            <div className="flex justify-between items-center mb-6">
                                <div>
                                    <h1 className="text-2xl font-bold text-gray-800">
                                        AI Özeti: {notebookPath}
                                    </h1>
                                    {summaryData.last_updated && (
                                        <p className="text-sm text-gray-500">
                                            Son güncelleme: {formatDate(summaryData.last_updated)}
                                        </p>
                                    )}
                                </div>
                                <div className="flex space-x-2">
                                    <a
                                        href={`/view/${notebookPath}`}
                                        className="px-3 py-2 text-sm bg-blue-600 text-white rounded hover:bg-blue-700"
                                    >
                                        Notebook'u Görüntüle
                                    </a>
                                    <a
                                        href="/"
                                        className="px-3 py-2 text-sm bg-gray-600 text-white rounded hover:bg-gray-700"
                                    >
                                        Notebook Listesi
                                    </a>
                                </div>
                            </div>

                            {summaryData.error ? (
                                <div className="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-6" role="alert">
                                    <p className="font-bold">Hata</p>
                                    <p>{summaryData.error}</p>
                                </div>
                            ) : (
                                <div className="space-y-8">
                                    <div className="bg-white rounded-lg shadow-md p-6">
                                        <h2 className="text-xl font-semibold mb-4">Özet</h2>
                                        <div
                                            className="prose max-w-none"
                                            dangerouslySetInnerHTML={renderMarkdown(summaryData.summary)}
                                        />
                                    </div>

                                    <div className="bg-white rounded-lg shadow-md p-6">
                                        <h2 className="text-xl font-semibold mb-4">Kod Açıklaması</h2>
                                        <div
                                            className="prose max-w-none"
                                            dangerouslySetInnerHTML={renderMarkdown(summaryData.code_explanation)}
                                        />
                                    </div>
                                </div>
                            )}
                        </div>
                    </main>
                    <Footer />
                </React.Fragment>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>